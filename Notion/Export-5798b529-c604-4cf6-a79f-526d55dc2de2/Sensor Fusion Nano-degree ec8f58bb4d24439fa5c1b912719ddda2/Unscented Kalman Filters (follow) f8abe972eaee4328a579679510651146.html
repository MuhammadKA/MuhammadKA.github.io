<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Unscented Kalman Filters (follow)</title><style>
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="f8abe972-eaee-4328-a579-679510651146" class="page sans"><header><div class="page-header-icon undefined"><span class="icon">3️⃣</span></div><h1 class="page-title">Unscented Kalman Filters (follow)</h1></header><div class="page-body"><h3 id="ef7eb283-6492-48d8-ae78-0c4ae91a79dd" class="">Sigma Point Prediction</h3><figure id="1e7ac068-c295-457f-ac1d-4d1b89a73e0f" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled.png"/></a></figure><ul id="028e356a-db9e-49aa-84d8-15ae0db63442" class="bulleted-list"><li>For the prediction step, we insert every sigma point into the process model. We store every predicted sigma point as a column of a matrix. </li></ul><ul id="6366d820-3306-4331-be5a-6d1c149976f9" class="bulleted-list"><li>The input to the process model is a 7 dimensional augmented vector (5 state dimensions + 2 noise dimensions). The output is a 5 dimensional vector, because this is what the process model returns. </li></ul><figure id="e8f5141e-d848-4e44-991a-23d97fef1fe3" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%201.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%201.png"/></a></figure><h2 id="1375e62f-06ea-4c40-b9c8-6719aef6be2c" class="">Predicted Mean and Covariance</h2><figure id="5fe04631-5320-4a44-8458-e2b5c0d4e216" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%202.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%202.png"/></a></figure><p id="554ce6ed-733b-4835-a482-11c089b848af" class="">First, we generated the sigma points. Then, we predicted them. Now, we want to use the sigma points to calculate the mean and the covariance of the predicted state. </p><figure id="b7eed822-261b-498f-898d-ee69ea17e1d2" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%203.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%203.png"/></a></figure><p id="26d64328-5367-475c-9458-c4ee1f97c7a3" class="">We need a weight for every sigma point. The weights depend on the spreading parameter Lambda. (We used Lambda to set how far we want to spread the sigma point). We need to consider Lambda again here because before we had a covariance and generated sigma points. Now (at k+1|k), we are doing the inverse step, we have predicted sigma points and we want to recover the covariance matrix. So we also have to invert the spreading of the sigma points. This is what the weights do. </p><figure id="ae21e479-866e-4924-b043-d244199135d8" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%204.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%204.png"/></a></figure><figure id="2986fac4-c9aa-4b4a-a36d-7326e543673e" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%205.png"><img style="width:961px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%205.png"/></a></figure><figure id="f5a99865-7849-4d18-844d-1a12a675746c" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%206.png"><img style="width:932px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%206.png"/></a></figure><figure id="ff001cb2-0927-437d-ba25-94e2ef5342e4" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%207.png"><img style="width:981px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%207.png"/></a></figure><h2 id="3442045a-b965-4048-be4e-0e7890b50d29" class="">Measurement Prediction</h2><figure id="f1024788-f95f-4430-9409-582a932e2458" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%208.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%208.png"/></a></figure><p id="9944564d-a4d7-40a3-b60d-59ed50ac85fb" class="">We have to transform the predicted state to the measurement space. The function that defines this transformation is the measurement model. Sure we have to consider what type of sensor produced the current measurement, and use the correspondent measurement model. </p><p id="b49a4012-5583-4722-9236-453978c2b627" class="">This problem is very similar to the one in the prediction step. We need to transform a distribution through a non linear function, so we can apply exactly the same unscented transformation approach as we did before.</p><p id="91041984-87c1-46ae-8452-9438c630555a" class="">We can do a shortcut here to make things easier; the first thing we did in the prediction step is that we generated sigma points, we would make this again using the predicted mean and covariance matrix → But we can just reuse the sigma points we already have from the prediction step.</p><p id="119fe3fb-33aa-43da-9033-dbc3ff480633" class="">We can also skip the augmentation step...Why?
We needed the augmentation because the process noise had a non linear effect on the state. But here the measurement noise has a purely additive effect, in this case we don&#x27;t need to perform augmentation; since there is an easier way to consider the measurement noise which we will tackle later.</p><p id="7076fb51-87d8-45a0-90ca-1b992ef62b9f" class="">Now we just have to transform the sigma points we already have to the measurement space, and use them to calculate the mean and the covariance matrix of the predicted measurement. </p><figure id="34e5b1a5-3c53-4d6e-845b-6d8242257286" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%209.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%209.png"/></a></figure><p id="1dcbe80c-eb44-4e76-b454-d4b954660a27" class="">The measurement space of the radar was a 3D space. </p><figure id="aa88ca8d-8876-41d0-a84e-0f0e1aefe67f" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2010.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2010.png"/></a></figure><figure id="ca1c9838-71ad-4d7e-a29f-a90f43a0b2f7" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2011.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2011.png"/></a></figure><figure id="91c9e24f-8653-4e0f-9043-fdb613969bcc" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2012.png"><img style="width:826px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2012.png"/></a></figure><figure id="ae87033e-5f68-496f-804b-5939633184b8" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2013.png"><img style="width:1113px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2013.png"/></a></figure><h2 id="044426db-7eb5-4a80-b1ca-2a4f23698914" class="">UKF Update</h2><figure id="cd9f878e-e0ed-4c5a-b43b-ef394eb3fef6" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2014.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2014.png"/></a></figure><p id="94905212-9dbd-47a9-a896-1f81b6290740" class=""><strong>What we have: </strong></p><figure id="f8fdfd0c-6631-4962-a831-e21c5fdd10c0" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2015.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2015.png"/></a></figure><p id="58345491-3816-4858-8576-58ea44848a0d" class="">There is one more thing that we need; the actual measurement Z|k+1, that we receive for the time step k+1. <strong>This is the first time that we really need to know the measurement values</strong>. What we needed right from the beginning was the time of the measurement, so we can predict to the correct time, and the later the sensor type so we can use the correct measurement model in the measurement prediction step. </p><figure id="01c1e1b4-a8e6-4b53-8f3a-87dbc0b969af" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2016.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2016.png"/></a></figure><figure id="ef95be0c-02ed-4439-80e5-5c14dc2c438e" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2017.png"><img style="width:987px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2017.png"/></a></figure><h2 id="623ce6a2-438b-48f2-8e52-f4ea4f98eece" class="">Parameters and Consistency</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="64750d5b-59e3-4f3a-8ce2-928fcfb8b032"><div style="font-size:1.5em"><span class="icon">🔥</span></div><div style="width:100%">The video in this lesson is Impressive 🤩</div></figure><figure id="613ff804-9ed9-47d6-8d01-f812e7f3c051" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2018.png"><img style="width:1021px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2018.png"/></a></figure><figure id="3ff3e5de-d2e5-470b-958e-7f49e4a1158a" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2019.png"><img style="width:1037px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2019.png"/></a></figure><h3 id="883098a2-6afe-4614-8096-d3a8022c26cb" class="">Yaw Acceleration Noise Parameter Intuition</h3><figure id="2fa859c1-530a-40f7-83cd-9091d9e6d66a" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2020.png"><img style="width:978px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2020.png"/></a></figure><h3 id="7219d86f-3338-427c-a5a4-18f4cdc49597" class="">Measurement Noise Parameters</h3><p id="380af416-dd9b-470c-a54b-035981e1126b" class="">Measurement noise parameters represent uncertainty in sensor measurements. In general, the manufacturer will provide these values in the sensor manual. In the UKF project, you will not need to tune these parameters.</p><h2 id="bdde0a36-12cc-481f-bc76-a8add779ad5a" class="">Consistency: Normalized Innovation Squared (NIS)</h2><p id="822e22a3-7a5f-4408-8243-ed2a47a4b058" class="">A measure to know if you set the noise parameters correctly. In the following case, the actual measurement occurs somewhere inside the error ellipse, so everything looks Ok.</p><figure id="eebaaa93-94e6-43d9-acca-c4e20b8a9ca8" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-52-52.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-52-52.png"/></a></figure><p id="be869c48-614b-49ec-a1df-57ebf7904bb2" class="">If the results kept looking like the cases on the right, something is wrong. These results tells you that you underestimate the uncertainty in your system. Your estimate is less precise than you think. </p><figure id="8affe745-9e89-48cd-8960-46594108990a" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-55-11.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-55-11.png"/></a></figure><p id="9518b203-3b41-49e7-b492-df036f241821" class="">Here you overestimate the uncertainty in your system. It means that your estimate is actually more precise than you think. This filter is also inconsistent.</p><figure id="e0a31626-e53b-47aa-9153-79ff8fc51fa3" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-57-43.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-57-43.png"/></a></figure><h3 id="32e7f182-02e7-4c00-a4d3-59f4eaa1dc7c" class="">Normalized Innovation Squared Consistency Check</h3><figure id="fabac218-1ab8-478d-b659-8484464ae1db" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-59-21.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_17-59-21.png"/></a></figure><p id="73c153a5-e1de-42a3-ba2b-6d6ad079e1ad" class="">NIS is just a scalar number and so easy to calculate. But what number should we expect? </p><figure id="ba226bc2-a66f-4a8d-972f-11260754077c" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_18-01-52.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_18-01-52.png"/></a></figure><p id="c8d0dfe0-cf64-444d-803e-7d104118a798" class=""><strong>df: </strong>degrees of freedom, the dimension of our measurement space. The first column means that for 95% of all the cases, your NIS values should be higher than the given number based on the df. </p><p id="b2c8a1ef-69ad-4e1e-9286-e35f63cdba48" class="">We should always plot the 95% line and check for the shape of the NIS values. The next curve is actually a good one and means that our noise parameters are good.</p><figure id="ba6e35c1-5950-4b5d-ac4f-04e2de191cc6" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_18-05-55.png"><img style="width:1920px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Screenshot_from_2020-11-15_18-05-55.png"/></a></figure><p id="1a9ec154-a21d-4598-8a38-6769e94a5fa4" class="">Unfortunately, the NIS doesn&#x27;t tell you where the mistake comes from, but at least it gives you some feedback.</p><h3 id="cd35dc34-2b3d-472a-a74a-e716c9c62b48" class="">What to Expect from the Project</h3><h3 id="bb643aab-6c84-41ea-9a02-1a7bc356e3ea" class="">Initializing the Kalman Filter</h3><p id="8530b851-1418-4d8d-bed3-ea4ecf161bca" class="">As discussed previously, the process noise parameters have an important effect on your Kalman filter; you will need to tune the longitudinal and yaw acceleration noise parameters as part of the
project. The initial values for your state variables will also affect your Kalman filter&#x27;s performance. Both the:</p><ul id="7916afd6-c235-4635-b81e-e75eb29c9c29" class="bulleted-list"><li>state vector <strong>x</strong> and the</li></ul><ul id="4790605c-d836-4e16-b59a-9052331c8865" class="bulleted-list"><li>state covariance matrix <strong>P</strong></li></ul><p id="4359f30e-64aa-4708-a717-afadc640a634" class="">need to be initialized for the unscented Kalman filter to work properly.</p><h3 id="363af409-913e-4ef4-b959-8b5646f44a3b" class="">Initializing the State Vector x</h3><p id="c5c3e8e5-7592-4112-a643-aafc9acf532d" class="">The state vector <strong>x</strong> contains x = [px, py, v, ψ, ψ˙]. You won&#x27;t know where the bicycle is until you receive the first sensor measurement. Once the first sensor measurement arrives, you can initialize px and py.  For the other variables in the state vector <strong>x</strong>, you can try different initialization values to see what works best.</p><p id="88f2d609-d2d6-469a-ba6c-ed8430860e8d" class=""><strong>Note</strong> that although radar does include velocity information, the radar velocity and the CTRV velocity are not the same. Radar velocity is measured from the autonomous vehicle&#x27;s perspective. If you drew a straight line from the vehicle to the bicycle, radar measures the velocity along that line.</p><p id="7b8fabdb-ca17-46f6-b258-3147be14bdeb" class="">In the CTRV model, the velocity is from the object&#x27;s perspective, which in this case is the bicycle; the CTRV velocity is tangential to the circle along which the bicycle travels. Therefore, you cannot
directly use the radar velocity measurement to initialize the state vector.</p><h3 id="54cd91ec-757e-4ec7-8cb6-fbe563f35834" class="">Initializing the State Covariance Matrix P</h3><p id="d0079e4e-4072-4147-921c-f0bded58e6e2" class="">To initialize the state covariance matrix <strong>P</strong>, one option is to start with the identity matrix. For the CTRV model, <strong>P</strong> is a 5x5 matrix. The identity matrix would be:</p><figure id="4f8a68a6-43c2-4f4f-a586-b1bc92b3a98e" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2021.png"><img style="width:707px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2021.png"/></a></figure><p id="f1965f0d-1561-49b3-aeec-f997a7a1c6b1" class="">Think back to what the state covariance matrix represents: take for example the value in the first row, second column. The value at (1, 2) would be the covariance σpx,py measuring the linear relationship between the two variables. The diagonal values represent the variances for each of the variables in the <strong>x</strong> state vector.</p><p id="9819f9db-53da-4675-8bc3-289be0d1f705" class="">Why is the identity matrix a good place to start? Since the non-diagonal values represent the covariances between variables, the <strong>P</strong> matrix is symmetrical. The identity matrix is also symmetrical. The symmetry comes from the fact that the covariance between two variables is the same whether you look at (x, y) or (y, x). </p><p id="a7d42bce-4a34-4208-ae36-9b5c3038dc93" class="">If you print out the <strong>P</strong> matrix in your UKF code, you will see that <strong>P</strong> remains symmetrical even after the matrix gets updated. If your solution is working, you will also see that P starts to converge to
small values relatively quickly. Instead of setting each of the diagonal values to 1, you can try
setting the diagonal values by how much difference you expect between the true state and the initialized <strong>x</strong> state vector. For example, in the project, we assume the standard deviation of the lidar x and y measurements is 0.15. If we initialized px with a lidar measurement, the initial variance or uncertainty in px would probably be less than 1. You will have to experiment with different initialization values to find a working solution.</p><h2 id="1a0777c8-5949-4890-a6b6-984fec21d91d" class="">Additional Project Details</h2><h3 id="461baf1a-58b5-47dc-95c2-3be16837726c" class="">Highway Parameters</h3><p id="c09fb386-40ad-4a83-8021-70e3c578eebd" class="">In <code>highway.h</code> there are a number of parameters that can be modified to help with testing and understanding.</p><pre id="a17123d9-ca53-4f6e-a259-62e8ec3979c8" class="code"><code>// Parameters 
// --------------------------------
// Set which cars to track with UKF
std::vector&lt;bool&gt; trackCars = {true,true,true};
// Visualize sensor measurements
bool visualize_lidar = true;
bool visualize_radar = true;
bool visualize_pcd = false;
// Predict path in the future using UKF
double projectedTime = 0;
int projectedSteps = 0;
// --------------------------------</code></pre><p id="5ac905ac-7861-4575-96af-1ef45e4e6b86" class="">The <code>trackCars</code> list can be used to toggle on/off cars for the UKF objects to track. The default is to track all three cars on the road, but for testing it can be nice to toggle to only track one at a time. For instance to only track the first car <code>{true,false,false}</code>.</p><figure id="699a5f86-0637-49e6-a202-d7077ffcaaea" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2022.png"><img style="width:770px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2022.png"/></a></figure><p id="51fcb1c2-58ae-4db8-ba3b-948f8c2c9541" class="">The image above shows what it looks like if the <code>projectedTime</code> and <code>projectedSteps</code> variables are used. Also in the animation above the visualization for lidar and radar has been set to <code>false</code> and <code>projectedTime = 2</code> and <code>projectedSteps = 6</code>. The green spheres then show the predicted position for the car in the future over a 2 second interval. The number of steps increases the number of positions to interpolate the time interval. It&#x27;s interesting to see the predicted path which is constrained by the motion model. In this project the motion model used is CTRV, which
assumes constant velocity and turning rate. Since our cars do not have constant turning rates you can see the predicted paths swing around and take a while to correct after the car begins moving straight again.</p><figure id="04543f16-35bc-4c13-8a7a-a78c525a4f07" class="image"><a href="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2023.png"><img style="width:770px" src="Unscented%20Kalman%20Filters%20(follow)%20f8abe972eaee4328a579679510651146/Untitled%2023.png"/></a></figure><p id="f41a4e6b-5008-4b86-b4d6-84f1590a03b7" class="">The <code>visualize_pcd</code> parameter can be set to true to visualize the cars from the lidar&#x27;s perspective from point clouds. The traffic pcd data is available in <code>src/sensors/data/pcd</code> directory. As a bonus assignment this data could be used to cluster the individual cars using techniques from Lidar Obstacle Detection and then bounding boxes could be fitted around the car clusters. The bounding box centre (x,y) point could then be used to represent the lidar marker that would be fed into the UKF instead of the project pre-generated lidar marker from <code>tools.cpp</code> lidarSense function.</p><p id="e8b1ff6c-b8f6-4ada-965c-ab8100af4989" class="">
</p></div></article></body></html>